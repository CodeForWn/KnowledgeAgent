import requests
import os

# Flask 服务地址（本地）
url = "http://127.0.0.1:7777/api/generate_ppt_from_outline"

# 请求体 JSON 数据
payload = {
    "knowledge_point": "地球自转",
    "markdown": ("""
    # 地球自转——探索地球自转的原理、影响及实际应用
    
    【请填写】对“地球自转”的定义、基本特征及应用背景。
    
    ---
    
    ## 教学基本要求
    
    <!-- 教学要求部分，包含考纲目标与学习提示 -->
    - 地球运动的特征：要点提示：方向，周期；自转线速度和角速度
    - 要求示例：结合示意图说出地球运动的方向和周期；说明地球运动速度及其时空变化
    - 地球运动的地理意义：要点提示：地方时和区时；地转偏向现象
    - 要求示例：了解昼夜交替的成因，说明昼夜交替对自然环境和人类活动的影响；指导时区划分及日期变更的规定，学会根据区时计算不同地区的时差；知道地转偏向力及其对地表做水平运动物体运动方向的影响
    
    ---
    
    # 地转偏向 - 第1页
    ## 地转偏向
    <!-- 知识点“地转偏向”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“地转偏向”的定义、概念讲解与背景说明。
    ---
    ## 信风
    <!-- 知识点“信风”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“信风”的定义、概念讲解与背景说明。
    ---
    ## 季风
    <!-- 知识点“季风”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“季风”的定义、概念讲解与背景说明。
    ---
    ## 大气环流
    <!-- 知识点“大气环流”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“大气环流”的定义、概念讲解与背景说明。
    ---
    ## 洋流
    <!-- 知识点“洋流”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“洋流”的定义、概念讲解与背景说明。
    ---
    ## 地转偏向力
    <!-- 知识点“地转偏向力”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“地转偏向力”的定义、概念讲解与背景说明。
    ---
    # 地方时 - 第1页
    ## 地方时
    <!-- 知识点“地方时”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“地方时”的定义、概念讲解与背景说明。
    ---
    ## 日界线
    <!-- 知识点“日界线”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“日界线”的定义、概念讲解与背景说明。
    ---
    ## 自然日界线
    <!-- 知识点“自然日界线”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“自然日界线”的定义、概念讲解与背景说明。
    ---
    ## 人为日界线（国际）
    <!-- 知识点“人为日界线（国际）”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“人为日界线（国际）”的定义、概念讲解与背景说明。
    ---
    ## 时区
    <!-- 知识点“时区”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“时区”的定义、概念讲解与背景说明。
    ---
    ## 北京时间
    <!-- 知识点“北京时间”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“北京时间”的定义、概念讲解与背景说明。
    ---
    # 地方时 - 第2页
    ## 区时
    <!-- 知识点“区时”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“区时”的定义、概念讲解与背景说明。
    ---
    # 昼夜更替 - 第1页
    ## 昼夜更替
    <!-- 知识点“昼夜更替”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“昼夜更替”的定义、概念讲解与背景说明。
    ---
    ## 晨昏线
    <!-- 知识点“晨昏线”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“晨昏线”的定义、概念讲解与背景说明。
    ---
    ## 夜弧
    <!-- 知识点“夜弧”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“夜弧”的定义、概念讲解与背景说明。
    ---
    ## 昼弧
    <!-- 知识点“昼弧”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“昼弧”的定义、概念讲解与背景说明。
    ---
    ## 夜半球
    <!-- 知识点“夜半球”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“夜半球”的定义、概念讲解与背景说明。
    ---
    ## 昼半球
    <!-- 知识点“昼半球”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“昼半球”的定义、概念讲解与背景说明。
    ---
    # 自转速度 - 第1页
    ## 自转速度
    <!-- 知识点“自转速度”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“自转速度”的定义、概念讲解与背景说明。
    ---
    ## 线速度
    <!-- 知识点“线速度”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“线速度”的定义、概念讲解与背景说明。
    ---
    ## 角速度
    <!-- 知识点“角速度”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“角速度”的定义、概念讲解与背景说明。
    ---
    # 自转周期 - 第1页
    ## 自转周期
    <!-- 知识点“自转周期”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“自转周期”的定义、概念讲解与背景说明。
    ---
    ## 太阳日
    <!-- 知识点“太阳日”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“太阳日”的定义、概念讲解与背景说明。
    ---
    # 自转方向 - 第1页
    ## 自转方向
    <!-- 知识点“自转方向”讲解页 -->
    - **知识点定义与讲解**：在此处补充对“自转方向”的定义、概念讲解与背景说明。
    ---
    ## 小结
    - 本节内容围绕 **地球自转** 展开，涵盖其相关原理与知识点。
    - 【请填写】各子知识点之间的关系与逻辑顺序。
    ---
    ## 习题 1
    ### 地方时单选题（普通）.docx
    2020年11月6日11时19分（北京时间），全球首颗6G试验卫星“电子科技大学号”搭载长征六号遥三运载火箭在山西太原卫星发射中心成功升空，并顺利进入预定轨道，标志着中国航天正式进入6G探索时代。据此完成1-2题。
    1．全球首颗6G试验卫星“电子科技大学号”成功升空时，在伦敦的华人收看电视直播的当地区时是（   ）
    A．11月6日3时19分	B．11月6日4时19分
    C．11月6日5时19分	D．11月6日6时19分
    2．我国四大航天发射基地中，地球自转的线速度最快的是（   ）
    A．海南文昌（约20°N）	B．四川西昌（约28°N）
    C．山西太原（约38°N）	D．甘肃酒泉（约40°N）
    ---"""
    ),
    "textbook_pdf_path": "/home/ubuntu/work/kmcGPT/temp/resource/中小学课程/高中 地理/选必1/选必1 教材/第一单元地球自转部分.pdf",  # 替换为你本地真实PDF路径
    "llm": "qwen",  # 或 "qwen"
    "top_p": 0.9,
    "temperature": 0.7
}

# ========== 保存路径配置 ==========
output_dir = "/home/ubuntu/work/kmcGPT/temp/resource/测试结果"
os.makedirs(output_dir, exist_ok=True)

filename = f"{payload['knowledge_point']}.md"
output_path = os.path.join(output_dir, filename)

# ========== 请求发送 ==========
response = requests.post(url, json=payload, stream=True)

# ========== 响应处理 ==========
if response.status_code == 200:
    print("🟢 接口调用成功，正在写入文件...\n")
    with open(output_path, 'w', encoding='utf-8') as f:
        for line in response.iter_lines(decode_unicode=True):
            if line:
                print(line)
                f.write(line + '\n')

    print(f"\n✅ 已保存为 Markdown 文件：{output_path}")
else:
    print(f"🔴 接口请求失败：{response.status_code}")
    print(response.text)
